#!/usr/bin/env sh
#desktop - install desktop programs and configuration
set_file() ( f="$1"; shift; printf '%s\n' "$@" | sudo tee "$f" >/dev/null; )

case "$(uname -s)" in
Linux)
    sudo mkdir -p /etc/systemd/system/getty@tty1.service.d
    set_file /etc/systemd/system/getty@tty1.service.d/override.conf \
        '[Service]' \
        'Type=simple' \
        'ExecStart=' \
        'ExecStart=-/usr/bin/agetty --skip-login --login-options "-f mil"'`
            `' --noissue --noclear %I $TERM'
    sudo mkdir -p /etc/systemd/logind.conf.d
    set_file /etc/systemd/logind.conf.d/gui.conf \
        '[Login]' \
        'HandlePowerKey=ignore' \
        'HandlePowerKeyLongPress=poweroff'
    sudo pacman --needed --noconfirm -qS sway swaybg \
        adobe-source-sans-fonts ttf-sourcecodepro-nerd ttf-joypixels \
        xdg-desktop-portal-wlr gnome-themes-extra gammastep avahi \
        pipewire pipewire-pulse wireplumber pipewire-zeroconf gcr bluez
    sudo usermod -aG video mil
    sudo systemctl enable --now avahi-daemon
    ;;
Darwin)
    #Tap-to-click
    defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true
    sudo defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad \
        Clicking -bool true
    sudo defaults -currentHost write NSGlobalDomain \
        com.apple.mouse.tapBehavior -int 1
    #Style
    sudo defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1
    defaults write NSGlobalDomain AppleHighlightColor \
        "0.847059 0.847059 0.862745";
    defaults write NSGlobalDomain AppleInterfaceStyle Dark
    defaults write NSGlobalDomain AppleAquaColorVariant 6
    defaults write NSGlobalDomain _HIHideMenuBar -bool true
    defaults write com.apple.dock autohide -bool true && \
    defaults write com.apple.dock autohide-delay -float 1000 && \
    defaults write com.apple.dock no-bouncing -bool TRUE && \
    defaults write com.apple.dock mru-spaces -bool false && \
        killall Dock
    defaults write com.apple.finder QuitMenuItem -bool true && \
        killall Finder
    killall Dock SystemUIServer
    defaults write com.apple.Terminal FocusFollowsMouse -string YES
    #Default software
    brew cask install darktable whatsapp osxfuse hammerspoon
    brew install pinentry-mac
    #Hammerspoon XDG
    defaults write org.hammerspoon.Hammerspoon MJConfigFile \
        "$XDG_CONFIG_HOME/hammerspoon/init.lua"
    ;;
esac
